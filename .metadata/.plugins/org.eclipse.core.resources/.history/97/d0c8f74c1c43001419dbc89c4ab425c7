package com.designer.gwt.client;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;

import com.designer.gwt.client.ContactDatabase.Category;
import com.designer.gwt.client.ContactDatabase.ContactInfo;
import com.designer.gwt.client.RequirementDatabase.Assessor;
import com.designer.gwt.client.RequirementDatabase.RequirememtInfo;
import com.google.gwt.cell.client.CheckboxCell;
import com.google.gwt.cell.client.EditTextCell;
import com.google.gwt.cell.client.FieldUpdater;
import com.google.gwt.cell.client.NumberCell;
import com.google.gwt.cell.client.SelectionCell;
import com.google.gwt.cell.client.TextCell;
import com.google.gwt.core.client.GWT;
import com.google.gwt.dom.client.Style.Unit;
import com.google.gwt.i18n.client.Constants;
import com.google.gwt.safehtml.shared.SafeHtmlUtils;
import com.google.gwt.uibinder.client.UiBinder;
import com.google.gwt.uibinder.client.UiField;
import com.google.gwt.user.cellview.client.Column;
import com.google.gwt.user.cellview.client.ColumnSortEvent.ListHandler;
import com.google.gwt.user.cellview.client.DataGrid;
import com.google.gwt.user.cellview.client.Header;
import com.google.gwt.user.cellview.client.SafeHtmlHeader;
import com.google.gwt.user.cellview.client.SimplePager;
import com.google.gwt.user.cellview.client.SimplePager.TextLocation;
import com.google.gwt.user.client.ui.Composite;
import com.google.gwt.user.client.ui.HasText;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.Widget;
import com.google.gwt.view.client.DefaultSelectionEventManager;
import com.google.gwt.view.client.MultiSelectionModel;
import com.google.gwt.view.client.SelectionModel;

public class DataGridTest extends Composite {

	private static DataGridTestUiBinder uiBinder = GWT
			.create(DataGridTestUiBinder.class);

	interface DataGridTestUiBinder extends UiBinder<Widget, DataGridTest> {
	}
	
	  /**
	   * The constants used in this Content Widget.
	   */
	  public static interface CwConstants extends Constants {
	    String cwDataGridColumnRequirement();

	    String cwDataGridColumnMinValue();

	    String cwDataGridColumnMaxValue();
	    
	    String cwDataGridColumnUnit();

	    String cwDataGridColumnAssessor();
	    
	    String cwDataGridEmpty();

	  }

	  /**
	   * The main DataGrid.
	   */
	  @UiField(provided = true)
	  DataGrid<RequirememtInfo> dataGrid;

	  /**
	   * An instance of the constants.
	   */
	  private final CwConstants constants = new CwConstants(){

		@Override
		public String cwDataGridColumnRequirement() {
			// TODO Auto-generated method stub
			return "Requirment";
		}

		@Override
		public String cwDataGridColumnMinValue() {
			// TODO Auto-generated method stub
			return "Min";
		}

		@Override
		public String cwDataGridColumnMaxValue() {
			// TODO Auto-generated method stub
			return "Max";
		}
		
		@Override
		public String cwDataGridColumnUnit() {
			// TODO Auto-generated method stub
			return "Unit";
		}

		@Override
		public String cwDataGridColumnAssessor() {
			// TODO Auto-generated method stub
			return "Assessor";
		}

		@Override
		public String cwDataGridEmpty() {
			// TODO Auto-generated method stub
			return "No Requirements To Show";
		}
	  };

	public DataGridTest() {
		
		// Create a DataGrid.

	    /*
	     * Set a key provider that provides a unique key for each contact. If key is
	     * used to identify contacts when fields (such as the name and address)
	     * change.
	     */
	    dataGrid = new DataGrid<RequirememtInfo>(RequirementDatabase.RequirememtInfo.KEY_PROVIDER);
	    dataGrid.setWidth("100%");

	    /*
	     * Do not refresh the headers every time the data is updated. The footer
	     * depends on the current data, so we do not disable auto refresh on the
	     * footer.
	     */
	    dataGrid.setAutoHeaderRefreshDisabled(true);

	    // Set the message to display when the table is empty.
	    dataGrid.setEmptyTableWidget(new Label(constants.cwDataGridEmpty()));

	    // Attach a column sort handler to the ListDataProvider to sort the list.
//	    ListHandler<ContactInfo> sortHandler =
//	        new ListHandler<ContactInfo>(ContactDatabase.get().getDataProvider().getList());
//	    dataGrid.addColumnSortHandler(sortHandler);

	    // Create a Pager to control the table.
//	    SimplePager.Resources pagerResources = GWT.create(SimplePager.Resources.class);
//	    pager = new SimplePager(TextLocation.CENTER, pagerResources, false, 0, true);
//	    pager.setDisplay(dataGrid);

	    // Add a selection model so we can select cells.
	    final SelectionModel<RequirememtInfo> selectionModel =
	        new MultiSelectionModel<RequirememtInfo>(RequirementDatabase.RequirememtInfo.KEY_PROVIDER);
	    dataGrid.setSelectionModel(selectionModel, DefaultSelectionEventManager
	        .<RequirememtInfo> createCheckboxManager());

	    // Initialize the columns.
	    initTableColumns(selectionModel);

	    // Add the CellList to the adapter in the database.
	    RequirementDatabase.getInstance().addDataDisplay(dataGrid);
	    
	    
		initWidget(uiBinder.createAndBindUi(this));
	}

	/**
	   * Add the columns to the table.
	   */
	  private void initTableColumns(final SelectionModel<RequirememtInfo> selectionModel) {
	    // Checkbox column. This table will uses a checkbox column for selection.
	    // Alternatively, you can call dataGrid.setSelectionEnabled(true) to enable
	    // mouse selection.
//	    Column<ContactInfo, Boolean> checkColumn =
//	        new Column<ContactInfo, Boolean>(new CheckboxCell(true, false)) {
//	          @Override
//	          public Boolean getValue(ContactInfo object) {
//	            // Get the value from the selection model.
//	            return selectionModel.isSelected(object);
//	          }
//	        };
//	    dataGrid.addColumn(checkColumn, SafeHtmlUtils.fromSafeConstant("<br/>"));
//	    dataGrid.setColumnWidth(checkColumn, 40, Unit.PX);

	    // Requirment name.
	    Column<RequirememtInfo, String> requirementColumn =
	        new Column<RequirememtInfo, String>(new EditTextCell()) {
	          @Override
	          public String getValue(RequirememtInfo object) {
	            return object.getRequirment();
	          }
	        };
	        requirementColumn.setSortable(true);

	    dataGrid.addColumn(requirementColumn, constants.cwDataGridColumnRequirement());
	    requirementColumn.setFieldUpdater(new FieldUpdater<RequirememtInfo, String>() {
	      @Override
	      public void update(int index, RequirememtInfo object, String value) {
	        // Called when the user changes the value.
	        object.setRequirment(value);
	        ContactDatabase.get().refreshDisplays();
	      }
	    });
	    dataGrid.setColumnWidth(requirementColumn, 20, Unit.PCT);

	    // Max value.
	    Column<RequirememtInfo, String> maxValueColumn =
	        new Column<RequirememtInfo, String>(new EditTextCell()) {
	          @Override
	          public String getValue(RequirememtInfo object) {
	            return object.getMaxValue();
	          }
	        };
	    maxValueColumn.setSortable(true);
//	    sortHandler.setComparator(maxValueColumn, new Comparator<RequirememtInfo>() {
//	      @Override
//	      public int compare(ContactInfo o1, ContactInfo o2) {
//	        return o1.getLastName().compareTo(o2.getLastName());
//	      }
//	    });
	    dataGrid.addColumn(maxValueColumn, constants.cwDataGridColumnMaxValue());
	    maxValueColumn.setFieldUpdater(new FieldUpdater<RequirememtInfo, String>() {
	      @Override
	      public void update(int index, RequirememtInfo object, String value) {
	        // Called when the user changes the value.
	        object.setMaxValue(value);
	        ContactDatabase.get().refreshDisplays();
	      }
	    });
	    dataGrid.setColumnWidth(maxValueColumn, 20, Unit.PCT);

	    // Min value.
	    Column<RequirememtInfo, String> minValueColumn =
	        new Column<RequirememtInfo, String>(new EditTextCell()) {
	          @Override
	          public String getValue(RequirememtInfo object) {
	            return object.getMinValue();
	          }
	        };
	    minValueColumn.setSortable(true);
//	    sortHandler.setComparator(maxValueColumn, new Comparator<RequirememtInfo>() {
//	      @Override
//	      public int compare(ContactInfo o1, ContactInfo o2) {
//	        return o1.getLastName().compareTo(o2.getLastName());
//	      }
//	    });
	    dataGrid.addColumn(minValueColumn, constants.cwDataGridColumnMinValue());
	    minValueColumn.setFieldUpdater(new FieldUpdater<RequirememtInfo, String>() {
	      @Override
	      public void update(int index, RequirememtInfo object, String value) {
	        // Called when the user changes the value.
	        object.setMinValue(value);
	        ContactDatabase.get().refreshDisplays();
	      }
	    });
	    dataGrid.setColumnWidth(minValueColumn, 20, Unit.PCT);

	    // Assessor.
	    Column<RequirememtInfo, String> assessorColumn =
	        new Column<RequirememtInfo, String>(new EditTextCell()) {
	          @Override
	          public String getValue(RequirememtInfo object) {
	            return object.getAssessor().getDisplayName();
	          }
	        };
	        assessorColumn.setSortable(true);
//	    sortHandler.setComparator(maxValueColumn, new Comparator<RequirememtInfo>() {
//	      @Override
//	      public int compare(ContactInfo o1, ContactInfo o2) {
//	        return o1.getLastName().compareTo(o2.getLastName());
//	      }
//	    });
	    dataGrid.addColumn(assessorColumn, constants.cwDataGridColumnAssessor());
	    assessorColumn.setFieldUpdater(new FieldUpdater<RequirememtInfo, String>() {
	      @Override
	      public void update(int index, RequirememtInfo object, String value) {
	        // Called when the user changes the value.
	        object.setAssessor(new Assessor(value));
	        ContactDatabase.get().refreshDisplays();
	      }
	    });
	    dataGrid.setColumnWidth(minValueColumn, 20, Unit.PCT);

	    
	  }

	  public void redraw() {
		  dataGrid.redraw();
	  }

}
