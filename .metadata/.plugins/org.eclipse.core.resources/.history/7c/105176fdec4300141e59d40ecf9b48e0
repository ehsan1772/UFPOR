package com.designer.gwt.client;

import com.google.gwt.core.client.GWT;
import com.google.gwt.dom.client.Element;
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.event.dom.client.DragStartEvent;
import com.google.gwt.event.dom.client.DragStartHandler;
import com.google.gwt.resources.client.CssResource;
import com.google.gwt.uibinder.client.UiBinder;
import com.google.gwt.uibinder.client.UiField;
import com.google.gwt.uibinder.client.UiHandler;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.Button;
import com.google.gwt.user.client.ui.Composite;
import com.google.gwt.user.client.ui.DecoratedTabPanel;
import com.google.gwt.user.client.ui.FlowPanel;
import com.google.gwt.user.client.ui.HTMLPanel;
import com.google.gwt.user.client.ui.PopupPanel;
import com.google.gwt.user.client.ui.Tree;
import com.google.gwt.user.client.ui.TreeItem;
import com.google.gwt.user.client.ui.Widget;

public class Designertest extends Composite {
	
	private int count = 0;

	private static DesignertestUiBinder uiBinder = GWT
			.create(DesignertestUiBinder.class);
	
	@UiField
	FlowPanel treeContainer;
	
	@UiField
	Button button;
	
	@UiField
	Button buttonLast;
	
	@UiField
	HTMLPanel envContainer;
	
	@UiField
	DecoratedTabPanel eastPanel;
	
	@UiField
	MyStyle style;

	interface DesignertestUiBinder extends UiBinder<Widget, Designertest> {
	}

	public Designertest() {
		initWidget(uiBinder.createAndBindUi(this));
		
		populateTree(treeContainer);
		
		eastPanel.selectTab(0);
		buttonLast.addClickHandler(new ClickHandler() {
			
			

			@Override
			public void onClick(ClickEvent event) {
				Button b = new Button("Yayy! " + count);
				count++;
				b.setStyleName("button.header");
				b.getElement().addClassName(style.header());
				
				//drag
				b.getElement().setDraggable(Element.DRAGGABLE_TRUE);
				b.addDragStartHandler(handler);
				
	
				envContainer.add(b);
				
			}
		});
	}
	
	private void populateTree(FlowPanel panel) {
		Tree t = new Tree();

		Button b = new Button("Tree! ");
		b.setStyleName("button.header");
		b.getElement().addClassName(style.header());
		
		TreeItem root = new TreeItem(new Button());
		t.addItem(root);
		panel.add(t);
		
	}

	private DragStartHandler handler = new DragStartHandler() {
		
		@Override
		public void onDragStart(DragStartEvent event) {
			// TODO Auto-generated method stub
			event.getDataTransfer().setDragImage(event.getRelativeElement(), 0, 0);
		}
	} ;
	

	@UiHandler("button")
	void onButtonClick(ClickEvent event) {
		final PopupPanel popup = new PopupPanel();

		int width = (Window.getClientWidth() / 2);
		popup.setWidth(width + "px");

		int height = (Window.getClientHeight() / 2);
		popup.setHeight(height + "px");

		popup.setGlassEnabled(true);
		popup.setWidget(new PopupBase());
		popup.center();

	}
	
	  interface MyStyle extends CssResource {
		    String header();
		  }
}
